# https://linuxblog.io/boost-battery-life-on-linux-laptop-tlp/

# FYI, you can actually run TLP and ACP together, advanced users can (and often do) run them together.
# However, because both tools attempt to write to the same /sys/devices/system/cpu/ files, you must be surgical
# with your configuration to prevent them from "fighting" (which leads to stuttering and high temperatures).

TLP_ENABLE=1
TLP_WARN_LEVEL=2
TLP_MSG_COLORS="91 93 97 92"
TLP_DEFAULT_MODE=BAL
TLP_AUTO_SWITCH=2
TLP_PERSISTENT_DEFAULT=0

SOUND_POWER_SAVE_ON_AC=3
SOUND_POWER_SAVE_ON_BAT=2
SOUND_POWER_SAVE_CONTROLLER=Y # Allow DSP controller power saving

RESTORE_THRESHOLDS_ON_BAT=1 # Maintain battery thresholds
NATACPI_ENABLE=1 # Battery care drivers
TPSMAPI_ENABLE=1 # THe above, but for ThinkPads

DISK_APM_LEVEL_ON_AC="254 254"
DISK_APM_LEVEL_ON_BAT="216 216"
DISK_SPINDOWN_TIMEOUT_ON_AC="120 120" # Spin-down after 10 min idle
DISK_SPINDOWN_TIMEOUT_ON_BAT="90 90" # Spin-down after 7.5 min idle
DISK_IOSCHED="kyber kyber"
# IOSched info:
# kyber - SSDs, highly efficient and modern
# mq-deadline - HDDs
# none - not recommended, can be unfair, even though technically fastest
SATA_LINKPWR_ON_AC="med_power_with_dipm"
SATA_LINKPWR_ON_BAT="med_power_with_dipm"
AHCI_RUNTIME_PM_ON_AC=auto
AHCI_RUNTIME_PM_ON_BAT=auto
AHCI_RUNTIME_PM_TIMEOUT=3

DISK_IDLE_SECS_ON_AC=0
DISK_IDLE_SECS_ON_BAT=2
MAX_LOST_WORK_SECS_ON_AC=30
MAX_LOST_WORK_SECS_ON_BAT=75

RADEON_DPM_PERF_LEVEL_ON_AC=auto
RADEON_DPM_PERF_LEVEL_ON_BAT=auto
RADEON_DPM_STATE_ON_AC=balanced
RADEON_DPM_STATE_ON_BAT=balanced
AMDGPU_ABM_LEVEL_ON_AC=4 # Adaptive Backlight Modulation given a high range, can give better contrast, power saving and lower burn-in
AMDGPU_ABM_LEVEL_ON_BAT=4

NMI_WATCHDOG=0 # No watchdog overhead

WIFI_PWR_ON_AC=off # Power saving mode can cause an unstable Wi-Fi link, mostly for gaming
WIFI_PWR_ON_BAT=on
WOL_DISABLE=N

PLATFORM_PROFILE_ON_AC=balanced
PLATFORM_PROFILE_ON_BAT=balanced
MEM_SLEEP_ON_AC=s2idle # Understandable, faster wakes
MEM_SLEEP_ON_BAT=deep # Although s2idle is "modern", its provides significantly lower power consumption, BUT this is great on modern laptops.

### This section is where auto-cpufreq is better than TLP ###
# amd/intel_pstate > acpi_cpufreq, always regardless of the utility
# OPMODE info:- guided > active > passive
# guided - guided autonomous, greater context of what is happening, based on the current workload
# active - autonomous, fine for hardware-based controlling, based on the energy performance preference
# passive - governor dictates the operating frequencies
# DISABLING THESE SO AUTO-CPUFREQ CAN TAKE OVER:
#CPU_DRIVER_OPMODE_ON_AC=guided
#CPU_DRIVER_OPMODE_ON_BAT=guided
#CPU_DRIVER_OPMODE_ON_SAV=guided
#CPU_SCALING_GOVERNOR_ON_AC=schedutil
#CPU_SCALING_GOVERNOR_ON_BAT=schedutil
#CPU_SCALING_GOVERNOR_ON_SAV=schedutil
#CPU_ENERGY_PERF_POLICY_ON_AC=balance_performance
#CPU_ENERGY_PERF_POLICY_ON_BAT=balance_power
#CPU_MIN_PERF_ON_AC=0
#CPU_MAX_PERF_ON_AC=100
#CPU_MIN_PERF_ON_BAT=0
#CPU_MAX_PERF_ON_BAT=80
#CPU_MIN_PERF_ON_SAV=0
#CPU_MAX_PERF_ON_SAV=55
#CPU_BOOST_ON_AC=1
#CPU_BOOST_ON_BAT=1
#CPU_HWP_DYN_BOOST_ON_AC=1
#CPU_HWP_DYN_BOOST_ON_BAT=1

RESTORE_DEVICE_STATE_ON_STARTUP=1 # Ensure that previous state of devices is followed
DEVICES_TO_DISABLE_ON_BAT_NOT_IN_USE="bluetooth wifi wwan" # Disable these if not in use if switching to battery
DEVICES_TO_ENABLE_ON_STARTUP="bluetooth wifi wwan"
DEVICES_TO_DISABLE_ON_STARTUP=""
DEVICES_TO_ENABLE_ON_AC="bluetooth wifi wwan"

# Conditional switching of devices
DEVICES_TO_DISABLE_ON_LAN_CONNECT="wifi wwan"
DEVICES_TO_DISABLE_ON_WIFI_CONNECT="wwan"
DEVICES_TO_DISABLE_ON_WWAN_CONNECT="wifi"
DEVICES_TO_ENABLE_ON_LAN_DISCONNECT="wifi wwan"
DEVICES_TO_ENABLE_ON_WIFI_DISCONNECT="wwan"
DEVICES_TO_ENABLE_ON_WWAN_DISCONNECT="wifi"

# Power down idle devices
RUNTIME_PM_ON_AC=auto
RUNTIME_PM_ON_BAT=auto
PCIE_ASPM_ON_AC=default
PCIE_ASPM_ON_BAT=default

USB_AUTOSUSPEND=1 # Allow auto-power off of peripherals
USB_EXCLUDE_BTUSB=0
USB_EXCLUDE_AUDIO=0
USB_EXCLUDE_PHONE=0
USB_EXCLUDE_PRINTER=0
USB_EXCLUDE_WWAN=0

#!/bin/zsh
clear
cd
sudo pacman -Syy base base-devel git
git clone https://aur.archlinux.org/git-git.git
git clone https://aur.archlinux.org/paru-git.git
git clone https://aur.archlinux.org/pacman-git.git
sudo pacman -Rddns --noconfirm pacman git
cd pacman-git
sudo renice -n -20 -p $BASHPID
makepkg -si --noconfirm
sudo renice -n 0 -p $BASHPID
cd
sudo rm -rf ~/pacman-git
cd git-git
sudo renice -n -20 -p $BASHPID
makepkg -si --noconfirm
sudo renice -n 0 -p $BASHPID
cd
sudo rm -rf ~/git-git

kill $SUDOREFRESHP
kill $NETRFP

#!/bin/zsh
sudo swapoff -a
# PkgConfigs---------------------------------------------------------------------------------------------------- 

jppkgrcf() {
sudo touch /usr/bin/JPpkg
sudo chmod 755 /usr/bin/JPpkg
sudo tee /usr/bin/JPpkg > /dev/null << "XIT"
#!/bin/bash
sudo systemctl enable JPpkg.timer
sudo systemctl disable JPpkg.service
if [[ "$1" == "upd" && "$(cat /sys/class/power_supply/AC/online)" == "1" ]]; then
sudo reflector --latest 5 --protocol https --sort rate --save /etc/pacman.d/mirrorlist
paru -Syu --noconfirm
fi
if [[ "$1" == "stop" ]]; then
sudo systemctl stop JPpkg.service
sudo systemctl stop JPpkg.timer
sudo pkill -f paru
fi
if [[ "$1" == "start" ]]; then
sudo systemctl enable --now JPpkg.timer
fi
if [[ "$1" == "make" ]]; then
multicore=false
for arg in "$@"; do
    if [[ "$arg" == -j* ]]; then
        multicore=true
        break
    fi
done
if [ "$multicore" = false ]; then
    set -- "$@" "-j$(nproc)"
fi
sudo renice -n -20 -p $BASHPID
exec makepkg "$@"
sudo renice -n 0 -p $BASHPID
fi
XIT
sudo touch /lib/systemd/system/JPpkg.service
sudo chmod 755 /lib/systemd/system/JPpkg.service
sudo tee /lib/systemd/system/JPpkg.service > /dev/null << "XIT"
[Unit]
Description=

[Service]
ExecStart=/usr/bin/JPpkg upd
Type=oneshot
XIT
sudo touch /lib/systemd/system/JPpkg.timer
sudo chmod 755 /lib/systemd/system/JPpkg.timer
sudo tee /lib/systemd/system/JPpkg.timer > /dev/null << "XIT"
[Unit]
Description=

[Timer]
OnCalendar=*-*-* *:00/1:00
Persistent=true

[Install]
WantedBy=timers.target
XIT
}
pacmanrcf

git clone https://aur.archlinux.org/git-git.git
git clone https://aur.archlinux.org/paru-git.git
git clone https://aur.archlinux.org/pacman-git.git
sudo pacman -Rns --noconfirm git pacman
cd pacman-git
sudo renice -n -20 -p $BASHPID
makepkg -si --noconfirm
sudo renice -n 0 -p $BASHPID
cd
sudo rm -rf ~/pacman-git
cd git-git
sudo renice -n -20 -p $BASHPID
makepkg -si --noconfirm
sudo renice -n 0 -p $BASHPID
cd
sudo rm -rf ~/git-git
git clone https://aur.archlinux.org/paru-git.git
cd paru-git
sudo renice -n -20 -p $BASHPID
makepkg -si --noconfirm
sudo renice -n 0 -p $BASHPID
cd
sudo rm -rf ~
# PackageInst----------------------------------------------------------------------------------------------------

for pkgs in\
 linux linux-headers
do paru -Rns --noconfirm $pkgs
done
sudo bootctl update #SystemD-Boot
sudo grub-mkconfig -o /boot/grub/grub.cfg #GRUB
if [[ "$1" == "N" ]]; then
 paru -Syu --noconfirm nvidia-open-dkms-git opencl-nvidia-beta nvidia-utils-beta nvidia-settings-beta nvidia-vpf-git nvflash
fi
if [[ "$1" == "A" ]]; then
 paru -Syu --noconfirm opencl-amd-dev amdvbflash
fi
# Tor----------------------------------------------------------------------------------------------------
sudo setcap cap_net_bind_service=+ep /usr/bin/obfs4proxy
cd /etc/systemd/system/
sudo chmod 755 tor@.service.d tor@default.service.d
# End----------------------------------------------------------------------------------------------------

# Network Drivers(if the adaptor is not detected):
# Install your network drivers before the main script
# Using your phone's USB Tethering to to install the network driver.
# Run the command below this line:
sudo apt update; for apkg in curl git dkms wget build-essential; do sudo apt install $apkg -y; done
# Now, find them from the web manually from your OEM or an alternative source.
# RTL88x2BU Network Driver by RinCat:
sudo git clone "https://github.com/RinCat/RTL88x2BU-Linux-Driver.git" /usr/src/rtl88x2bu-git
sudo sed -i 's/PACKAGE_VERSION="@PKGVER@"/PACKAGE_VERSION="git"/g' /usr/src/rtl88x2bu-git/dkms.conf
sudo dkms add -m rtl88x2bu -v git
sudo dkms autoinstall

# Science United
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 40254C9B29853EA6
sudo apt-add-repository deb https://boinc.berkeley.edu/dl/linux/nightly/noble noble main
sudo apt-fast update
sudo apt-fast dist-upgrade -y
sudo systemctl enable --now boinc-client
sudo usermod -aG boinc $USER
boinccmd --join_acct_mgr https://scienceunited.org/ $EMAIL $PASSWORD

exit

#!/bin/env fish
# for running a cmd as many users
set user_commands_string "
 echo emptyforfutureusesection
"

# Split the commands string into an array based on newlines
set user_commands (string split -n \n $user_commands_string)

# Iterate through each directory in /home/
# Redneck method to recognize users
for user_path in (ls -d /home/*)
    # Extract username from path
    set username (basename $user_path)

    # Check if it's a valid directory and not a system folder like lost+found
    if test -d "$user_path" -a "$username" != "lost+found"
        echo "For user: $username"

        # Run each command as the user
        for cmd in $user_commands
            # Skip empty lines
            if test -n "$cmd"
                sudo -u $username fish -c "$cmd"
                if test $status -eq 0
                    echo "y"
                else
                    echo "Error for $username: $cmd"
                end
            end
        end
    end
end
